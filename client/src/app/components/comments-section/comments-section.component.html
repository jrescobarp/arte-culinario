<div class="comentariosTitle mb-2">
  <div style="display: inline-flex;" [ngClass]="mainCommentSection ? 'lgTitleTxt' : 'smTitleTxt'">{{comments_arr.length}} Comentario{{comments_arr.length === 1 ?  '' : 's'}}</div>
  <div *ngIf="comments_arr.length" ngbDropdown class="d-inline-block" matTooltip="ordernar comentarios" [matTooltipPosition]="'above'">
    <button type="button" class="filterBtn" id="dropdownBasic1" ngbDropdownToggle>
      <i class="fa-solid fa-filter fa-xs"></i>
    </button>
    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
      <button ngbDropdownItem (click)="filtrarComentariosUpvotes('upvotes', 'desc')">mas likes</button>
      <button ngbDropdownItem (click)="filtrarComentariosUpvotes('upvotes', 'asc')">menos likes</button>
      <button ngbDropdownItem (click)="filtrarComentariosDate('date_created','desc')">nuevos comentarios primero</button>
      <button ngbDropdownItem (click)="filtrarComentariosDate('date_created','asc')">viejos comentarios primero</button>
    </div>
  </div>
</div>

<div class="mb-3">
  <div>
    <textarea name="comment_txt" class="comentariosTxtArea"
    [(ngModel)]="comment.text" (click)="commentBtnToggle(true)" placeholder="recomendacion o comentario"></textarea>
  </div>
  <div *ngIf="showBtns" class="mb-4" style="text-align: right;">
    <button class="btn- btn-red" style="margin-right: 1em;" (click)="deleteCommentTxt();commentBtnToggle(false);" >Cancel</button>
    <button class="btn- btn-green" (click)="submitComment(parentObject._id, parentObject.comments, parentType)">Submit</button>
  </div>
</div>

<div *ngIf="!comments_arr.length" class="text-center">
  <i class="fa-solid fa-comment-slash"></i><br>
  No hay comentarios
</div>

<ng-container *ngIf="comments_arr.length">
  <div *ngFor="let comment of parentObject.comments; index as i" class="row mx-1 my-3 pt-3" style="background-color: white;">
    <div class="col-12 mt-1 mb-2 commentTxt">{{comment.text}}</div>
    <div class="col-6 pb-2" style="margin-left: .5em;">
      <app-upvote-btn
        [mainComponent]="comment"
        [userId]="userInfo._id!"
        [componentType] = "'comment'"
      ></app-upvote-btn>
    </div>

    <div class="col pb-2" style="text-align: right;">
      <strong style="text-transform: capitalize;">
         - chef {{comment.username}}
      </strong>
      <div style="display: inline;margin-left: .75em;font-size: .75em;color: gray;">( {{comment.date_created | date}} )</div>
    </div>

    <div class="col-12 mb-1" style="padding-left:1em;border-top: .1px solid gray;padding-top: .25em;">
      <div *ngIf="comment.replies.length" style="display: inline-flex">
        <button id="showRepliesBtnChevronDown-{{comment._id}}" class="filterBtn" (click)="viewReplies(comment._id, comment, i)">{{comment.replies.length}} respuesta{{comment.replies.length > 1 ? 's' : ''}} <i class="fa-solid fa-chevron-down fa-xs commentReplyChevron" id="{{comment._id + '-' + i}}-comment-replies-chevron"></i></button>
      </div>
      <div class="noRepliesTxt" *ngIf="!comment.replies.length" style="display: inline-flex">0 respuesta{{comment.replies.length != 1 ? 's' : ''}}</div>
      <div style="display: inline-flex"><button class="filterBtn btn-green" (click)="showReplyInput(comment._id, 'block')" style="font-size: 1em;">responder</button></div>
    </div>

    <!-- Comment Replies -->
    <div id="{{comment._id + '-' + i}}-comment-replies" style="display: none;border-top: .1px solid gray;">
      <div *ngFor="let reply of comment.replies"  class="row mx-3" style="background-color: white;margin-left: .75em;">
        <div class="col-12 pt-2" style="border-left: .1px solid gray;border-right: .1px solid gray;font-size: 1.1em;">{{reply.text}}</div>
        <div class="col-12 pb-2" style="text-transform: capitalize;border-left: .1px solid gray;border-bottom: .1px solid gray;border-right: .1px solid gray;">
          <div class="row">
            <div class="col-6">
              <app-upvote-btn
                [mainComponent]="reply"
                [userId]="userInfo._id!"
                [componentType] = "'comment'"
              ></app-upvote-btn>
            </div>
            <div class="col-6" style="text-align: right;">
              <div style="display: inline-flex;margin-left: .75em;"><strong> - chef {{reply.username}}</strong></div>
              <div style="display: inline-flex;margin-left: .75em;font-size: .75em;color: gray;">( {{comment.date_created | date}} )</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="{{comment._id}}-comment" class="col-12 mx-3" style="display: none;">
      <textarea name="replyTxt" class="comentariosTxtArea replyTextarea" [(ngModel)]="replyTxt" placeholder="responder a {{comment.username}}" id="reply_comment_txt"></textarea>
      <div style="text-align: right;margin-right: 2em;">
        <button class="btn btn-red" style="margin-right: 1em;" (click)="replyTxt = '';showReplyInput(comment._id, 'none')">Cancel</button>
        <button class="btn btn-green" (click)="submitComment(comment._id, comment.replies, 'comment', true)">Submit</button>
      </div>
    </div>
  </div>

</ng-container>
